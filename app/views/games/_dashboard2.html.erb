<%
readonly = defined?(readonly) && readonly
open_kills = defined?(open_kills) && open_kills
admin_mode = defined?(admin_mode) && admin_mode
%>
<div class="player-cards">
  <% dashboard.each_with_index do |row, index| %>
    <%= render('games/dashboard2_player',
      row: row,
      readonly: readonly,
      admin_mode: admin_mode,
      open_kills: open_kills,
      hide_move_down: dashboard.length == index + 1
    ) %>
    <% if row[:cards].size > 0 %>
      <details class="player-cards__actions-done" <%= 'open' if open_kills %>>
        <summary class="badge"><b><%= row[:cards].size %></b> kills <%= 'ğŸ’€' * row[:cards].size %></summary>
        <div class="player-cards__actions-done__content">
          <% row[:cards].each do |card| %>
            <div class="player-cards__action player-cards__action--done">
              <p><b><%= format_time card.done_at %></b>: <%= card.action %></p>
            </div>
            <!-- dead player -->
            <div class="player-cards__player">
              <p><%= card.target.name %></p>
              <% if !readonly || admin_mode %>
                <ul class="actions">
                  <li><%= player_dashboard_link card.target %></li>
                </ul>
              <% end %>
            </div>
          <% end %>
        </div>
      </details>
    <% end %>
    <% if row[:current] %>
      <%# current is not set when user finished game %>
      <div class="player-cards__action">
        <p><%= row[:current].action %></p>
        <ul class="actions">
          <% unless readonly %>
            <li><%= edit_card_link row[:current] %></li>
          <% end %>
        </ul>
      </div>
    <% end %>
  <% end %>
  <%# display first player again %>
  <%= render('games/dashboard2_player',
      row: dashboard[0],
      readonly: readonly,
      open_kills: open_kills,
      admin_mode: admin_mode,
      hide_move_down: true
    ) if dashboard.size > 1 %>
</div>
