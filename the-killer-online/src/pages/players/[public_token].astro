---
import { STYLES } from "../../constants";
import Layout from "../../layouts/Layout.astro";
import { fetchGameBy, getGamePublicUrl } from "../../services/games";

import { fetchPlayerByPublicToken } from "../../services/players";

const player = await fetchPlayerByPublicToken(String(Astro.params.public_token));

if (!player) {
  return new Response("Player not found", {
    status: 404,
    statusText: "Not found",
  });
}

const game = await fetchGameBy("id", player.game_id);

if (!game) {
  return new Response("game not found", {
    status: 404,
    statusText: "Not found",
  });
}

const gamePublicUrl = getGamePublicUrl(game);

const title = `ðŸ‘‹ Hello ${player.name}`;
---

<Layout title={title}>
  <h1 class={STYLES.h1}>{title}</h1>

  <div class="text-sm breadcrumbs">
    <ul>
      <li><a href={getGamePublicUrl(game)}>Game {game.name}</a></li>
      <li>{player.name}'s dashboard</li>
    </ul>
  </div>

  <p>You're part of the game: <a href={gamePublicUrl}>{game.name}</a></p>

  <a href="/">Go back</a>
</Layout>
 ../../services/players
